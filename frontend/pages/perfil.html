<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - Ceveco</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="../assets/img/logo.png">

    <link rel="stylesheet" href="../assets/css/main.css">
    <script src="../assets/js/theme.config.js"></script>
    <style>
        .profile-nav-item {
            transition: all 0.2s ease;
        }

        .profile-nav-item:hover,
        .profile-nav-item.active {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .profile-nav-item.active {
            border-left: 3px solid #0056b3;
            font-weight: 500;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans flex flex-col">

    <div id="navbar-root"></div>

    <main class="flex-grow container mx-auto px-4 py-8 lg:py-12">

        <div class="max-w-7xl mx-auto flex flex-col lg:flex-row gap-8">
            <!-- Sidebar de Navegación -->
            <aside class="w-full lg:w-72 flex-shrink-0">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden sticky top-24">
                    <!-- User Header -->
                    <div class="p-6 border-b border-gray-100 text-center">
                        <div class="relative inline-block mb-3">
                            <div
                                class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden mx-auto border-4 border-white shadow-sm ring-1 ring-gray-100">
                                <img id="profile-avatar" src="" alt="Avatar" class="w-full h-full object-cover hidden">
                                <i data-lucide="user" class="w-8 h-8 text-gray-400" id="default-avatar"></i>
                            </div>
                        </div>
                        <h2 class="font-bold text-gray-900 truncate px-2" id="sidebar-name">Cargando...</h2>
                        <p class="text-xs text-gray-500 truncate px-2" id="sidebar-email">...</p>
                    </div>

                    <!-- Navigation Links -->
                    <nav class="p-2 space-y-1">
                        <a href="perfil.html"
                            class="profile-nav-item active flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 text-sm">
                            <i data-lucide="user" class="w-4 h-4"></i>
                            Datos Personales
                        </a>
                        <a href="pedidos.html"
                            class="profile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 text-sm">
                            <i data-lucide="package" class="w-4 h-4"></i>
                            Mis Pedidos
                        </a>
                        <a href="favoritos.html"
                            class="profile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 text-sm">
                            <i data-lucide="heart" class="w-4 h-4"></i>
                            Favoritos
                        </a>
                        <div class="px-4 py-2 mt-4">
                            <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Configuración
                            </div>
                        </div>
                        <a href="#" id="btn-logout"
                            class="profile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 text-sm hover:bg-red-50 hover:text-red-700">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            Cerrar Sesión
                        </a>
                    </nav>
                </div>
            </aside>

            <!-- Contenido Principal -->
            <div class="flex-1 space-y-8">
                <div class="flex items-center justify-between mb-2">
                    <h1 class="text-2xl lg:text-3xl font-bold text-gray-900">Mi Cuenta</h1>
                </div>

                <!-- 1. Mis Datos (Editable) -->
                <section class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 lg:p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600">
                                <i data-lucide="user" class="w-4 h-4"></i>
                            </div>
                            Información Personal
                        </h2>
                        <button id="btn-edit"
                            class="text-sm font-medium text-primary hover:text-primary-dark flex items-center gap-1 transition-colors px-3 py-1.5 rounded-lg hover:bg-blue-50">
                            <i data-lucide="edit-2" class="w-4 h-4"></i>
                            Editar
                        </button>
                    </div>

                    <form id="profile-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide">Nombre</label>
                                <input type="text" id="nombre" name="nombre" disabled
                                    class="w-full px-4 py-2.5 bg-gray-50 border border-transparent rounded-lg focus:bg-white focus:border-primary focus:ring-0 outline-none transition-all disabled:text-gray-700 disabled:bg-gray-50/50">
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide">Apellido</label>
                                <input type="text" id="apellido" name="apellido" disabled
                                    class="w-full px-4 py-2.5 bg-gray-50 border border-transparent rounded-lg focus:bg-white focus:border-primary focus:ring-0 outline-none transition-all disabled:text-gray-700 disabled:bg-gray-50/50">
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide">Email</label>
                                <div class="relative">
                                    <input type="email" id="email" name="email" disabled
                                        class="w-full pl-4 pr-10 py-2.5 bg-gray-100 border border-transparent rounded-lg text-gray-500 outline-none cursor-not-allowed">
                                    <i data-lucide="lock"
                                        class="w-4 h-4 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2"></i>
                                </div>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide">Teléfono</label>
                                <input type="tel" id="telefono" name="telefono" disabled
                                    class="w-full px-4 py-2.5 bg-gray-50 border border-transparent rounded-lg focus:bg-white focus:border-primary focus:ring-0 outline-none transition-all disabled:text-gray-700 disabled:bg-gray-50/50">
                            </div>
                        </div>

                        <div id="edit-actions" class="hidden justify-end gap-3 pt-4 border-t border-gray-100 mt-6">
                            <button type="button" id="btn-cancel-edit"
                                class="px-5 py-2.5 rounded-lg text-gray-600 bg-gray-100 hover:bg-gray-200 font-medium transition-colors text-sm">
                                Cancelar
                            </button>
                            <button type="submit"
                                class="px-5 py-2.5 rounded-lg text-white bg-primary hover:bg-primary-dark font-medium transition-colors text-sm shadow-sm flex items-center gap-2">
                                <i data-lucide="save" class="w-4 h-4"></i>
                                Guardar Cambios
                            </button>
                        </div>
                    </form>
                </section>

                <!-- 2. Mis Direcciones -->
                <section class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 lg:p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center text-green-600">
                                <i data-lucide="map-pin" class="w-4 h-4"></i>
                            </div>
                            Mis Direcciones
                        </h2>
                        <button id="btn-add-address"
                            class="text-sm font-medium text-white bg-gray-900 hover:bg-black px-4 py-2 rounded-lg flex items-center gap-2 transition-all shadow-sm">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            Agregar Nueva
                        </button>
                    </div>

                    <div id="addresses-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Loading State -->
                        <div class="col-span-full py-8 text-center text-gray-400">
                            <div
                                class="animate-spin w-6 h-6 border-2 border-gray-300 border-t-primary rounded-full mx-auto mb-2">
                            </div>
                            Cargando direcciones...
                        </div>
                    </div>
                </section>

                <!-- 3. Métodos de Pago (Solo Visual) -->
                <section class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 lg:p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <div
                                class="w-8 h-8 rounded-lg bg-purple-50 flex items-center justify-center text-purple-600">
                                <i data-lucide="credit-card" class="w-4 h-4"></i>
                            </div>
                            Métodos de Pago
                        </h2>
                    </div>

                    <div class="bg-gray-50 border border-dashed border-gray-200 rounded-lg p-6 text-center">
                        <div
                            class="w-12 h-12 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-sm">
                            <i data-lucide="shield-check" class="w-6 h-6 text-green-500"></i>
                        </div>
                        <h3 class="text-sm font-bold text-gray-900 mb-1">Pagos Seguros</h3>
                        <p class="text-xs text-gray-500 max-w-sm mx-auto">
                            Por tu seguridad, no almacenamos información sensible de tarjetas.
                            Todos los pagos son procesados y tokenizados directamente por <strong>Wompi</strong>.
                        </p>
                    </div>
                </section>

                <!-- 4. Seguridad (Acordeón) -->
                <section class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <button id="security-toggle"
                        class="w-full flex items-center justify-between p-6 hover:bg-gray-50 transition-colors text-left">
                        <h2 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center text-red-600">
                                <i data-lucide="key" class="w-4 h-4"></i>
                            </div>
                            Seguridad y Contraseña
                        </h2>
                        <i data-lucide="chevron-down"
                            class="w-5 h-5 text-gray-400 transition-transform duration-300"></i>
                    </button>

                    <div id="security-content" class="hidden border-t border-gray-100 p-6 lg:p-8 bg-gray-50/50">
                        <p class="text-sm text-gray-600 mb-6">
                            Para cambiar tu contraseña, debes confirmar tu contraseña actual.
                            <br> <span class="text-xs text-gray-400">Último cambio: Hace 3 meses</span>
                        </p>

                        <form id="password-form" class="max-w-md space-y-4">
                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase">Contraseña Actual</label>
                                <input type="password" id="current_password" required
                                    class="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase">Nueva Contraseña</label>
                                <input type="password" id="new_password" required minlength="6"
                                    class="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                            </div>
                            <div class="pt-2">
                                <button type="submit"
                                    class="w-full md:w-auto px-6 py-2.5 rounded-lg text-white bg-gray-900 hover:bg-black font-medium transition-colors text-sm shadow-sm">
                                    Actualizar Contraseña
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

            </div>
        </div>
    </main>

    <!-- Modal Agregar Dirección -->
    <div id="address-modal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden transform transition-all scale-100">
            <div class="flex items-center justify-between p-4 border-b border-gray-100">
                <h3 class="font-bold text-lg">Nueva Dirección</h3>
                <button id="btn-close-address-modal" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form id="address-form" class="p-6 space-y-5 max-h-[80vh] overflow-y-auto">
                <input type="hidden" name="id_direccion" id="address-id">

                <!-- Structured Address Builder -->
                <div class="space-y-3 bg-gray-50/50 p-4 rounded-xl border border-gray-100">
                    <label class="text-xs font-bold text-gray-700 uppercase tracking-wide block mb-2">Construir
                        Dirección</label>

                    <div class="grid grid-cols-12 gap-2 items-center">
                        <!-- Via Type -->
                        <div class="col-span-12 md:col-span-4">
                            <select id="addr_via"
                                class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                                <option value="Calle">Calle</option>
                                <option value="Carrera">Carrera</option>
                                <option value="Diagonal">Diagonal</option>
                                <option value="Transversal">Transversal</option>
                                <option value="Avenida">Avenida</option>
                                <option value="Circular">Circular</option>
                                <option value="Vereda">Vereda</option>
                            </select>
                        </div>

                        <!-- Via Number -->
                        <div class="col-span-4 md:col-span-2">
                            <input type="text" id="addr_num_via" placeholder="123"
                                class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm text-center focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                        </div>

                        <!-- Separator -->
                        <div class="col-span-1 flex justify-center text-gray-400 font-bold">#</div>

                        <!-- Crossing Number -->
                        <div class="col-span-3 md:col-span-2">
                            <input type="text" id="addr_num_cruce" placeholder="45"
                                class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm text-center focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                        </div>

                        <!-- Separator -->
                        <div class="col-span-1 flex justify-center text-gray-400 font-bold">-</div>

                        <!-- Plate Number -->
                        <div class="col-span-4 md:col-span-2">
                            <input type="text" id="addr_placa" placeholder="67"
                                class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm text-center focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                        </div>
                    </div>

                    <!-- Generated Preview -->
                    <div class="mt-2 text-center">
                        <p class="text-xs text-gray-500 mb-1">Vista Previa:</p>
                        <div id="address-preview"
                            class="font-mono text-sm font-semibold text-gray-800 bg-white border border-gray-200 px-3 py-2 rounded-lg">
                            Calle 123 # 45 - 67
                        </div>
                    </div>
                </div>

                <!-- Unit / Details -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1.5">
                        <label class="text-xs font-semibold text-gray-700">Tipo de Inmueble</label>
                        <select name="tipo"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:border-primary outline-none">
                            <option value="Casa">Casa</option>
                            <option value="Apartamento">Apartamento</option>
                            <option value="Edificio">Edificio</option>
                            <option value="Oficina">Oficina</option>
                            <option value="Conjunto">Conjunto Residencial</option>
                            <option value="Local">Local</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-xs font-semibold text-gray-700">Interior / Apto / Unidad</label>
                        <input type="text" id="addr_detail" placeholder="Ej: Apto 302, Torre B"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                    </div>
                </div>

                <!-- General Location -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1.5">
                        <label class="text-xs font-semibold text-gray-700">Departamento <span
                                class="text-red-500">*</span></label>
                        <select name="departamento" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:border-primary outline-none">
                            <option value="">Seleccionar...</option>
                            <option value="Caldas">Caldas</option>
                            <option value="Antioquia">Antioquia</option>
                            <option value="Risaralda">Risaralda</option>
                            <option value="Quindío">Quindío</option>
                            <option value="Valle del Cauca">Valle del Cauca</option>
                            <option value="Cundinamarca">Cundinamarca</option>
                            <option value="Bogotá D.C.">Bogotá D.C.</option>
                        </select>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-xs font-semibold text-gray-700">Ciudad <span
                                class="text-red-500">*</span></label>
                        <input type="text" name="ciudad" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                    </div>
                </div>

                <!-- Additional Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1.5">
                        <label class="text-xs font-semibold text-gray-700">Código Postal <span
                                class="text-gray-400 font-normal">(Opcional)</span></label>
                        <input type="text" name="codigo_postal"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-xs font-semibold text-gray-700">Barrio / Referencias</label>
                        <input type="text" name="referencias" placeholder="Ej: Frente al parque..."
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                    </div>
                </div>

                <div class="flex items-center pt-2">
                    <label class="flex items-center gap-2 cursor-pointer group">
                        <input type="checkbox" name="es_principal"
                            class="w-4 h-4 text-primary rounded border-gray-300 focus:ring-primary">
                        <span class="text-sm text-gray-700 group-hover:text-primary transition-colors">Marcar como
                            dirección principal</span>
                    </label>
                </div>

                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" id="btn-cancel-address"
                        class="px-4 py-2 rounded-lg text-gray-600 bg-gray-100 hover:bg-gray-200 text-sm font-medium">Cancelar</button>
                    <button type="submit"
                        class="px-4 py-2 rounded-lg text-white bg-primary hover:bg-primary-dark text-sm font-medium">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="footer-root"></div>

    <!-- Modern Core Services -->
    <!-- Config Load First -->
    <script src="../assets/js/config.js"></script>

    <script src="../assets/js/utils/constants.js"></script>
    <script src="../assets/js/utils/helpers.js"></script>
    <script src="../assets/js/utils/storage.js"></script>
    <script src="../assets/js/api/client.js"></script>
    <script src="../assets/js/services/auth.service.js"></script>
    <script src="../assets/js/services/products.service.js"></script>
    <script src="../assets/js/services/favorites.service.js"></script>
    <script src="../assets/js/services/orders.service.js"></script>
    <script src="../assets/js/core.js"></script>

    <!-- UI Logic -->

    <script src="../assets/js/components/cart-sidebar.js" defer></script>

    <!-- Modules -->
    <script type="module" src="../assets/js/auth/index.js"></script>
    <script type="module" src="../assets/js/favorites/index.js"></script>

    <!-- Page Specific Logic -->
    <script src="../assets/js/pages/perfil.js" defer></script>
</body>

</html>